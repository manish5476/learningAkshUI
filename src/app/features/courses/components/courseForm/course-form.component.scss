/* ==========================================================================
   HOST & GLOBALS (Tokens Only)
   ========================================================================== */
:host {
  display: block;
  font-family: var(--font-body);
  color: var(--text-primary);
  width: 100%;
}

.text-primary { color: var(--color-primary); }
.text-secondary { color: var(--text-secondary); }
.text-error { color: var(--color-error); }
.text-muted { color: var(--text-tertiary); }
.required { color: var(--color-error); margin-left: 2px; }

/* Panels & Surfaces */
.glass-panel {
  background: var(--glass-bg-c, var(--bg-secondary));
  backdrop-filter: blur(var(--glass-blur-c, 16px));
  -webkit-backdrop-filter: blur(var(--glass-blur-c, 16px));
  border: var(--ui-border-width) solid var(--glass-border-c, var(--border-primary));
  box-shadow: var(--shadow-xl);
  border-radius: var(--ui-border-radius-xl);
  padding: var(--spacing-4xl);
}

.surface-raised {
  background: var(--component-surface-raised, var(--bg-primary));
  border: var(--ui-border-width) solid var(--border-primary);
  border-radius: var(--ui-border-radius-lg);
  padding: var(--spacing-xl);
}

.surface-subtle {
  background: var(--bg-secondary);
  border: var(--ui-border-width) solid var(--border-primary);
  border-radius: var(--ui-border-radius-md);
}

/* ==========================================================================
   LAYOUT & HEADER
   ========================================================================== */
.course-form-container {
  max-width: 1100px; margin: 0 auto;
}

.form-header {
  display: flex; justify-content: space-between; align-items: flex-start;
  margin-bottom: var(--spacing-4xl); padding-bottom: var(--spacing-2xl);
  border-bottom: var(--ui-border-width) solid var(--border-primary); flex-wrap: wrap; gap: var(--spacing-xl);
}

.form-title { font-family: var(--font-heading); font-size: var(--font-size-4xl); font-weight: var(--font-weight-bold); margin: 0 0 var(--spacing-xs); }
.form-subtitle { font-size: var(--font-size-md); color: var(--text-secondary); margin: 0; }

.header-actions { display: flex; gap: var(--spacing-md); }

/* Buttons */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-xl); font-size: var(--font-size-md); font-weight: var(--font-weight-bold);
  border-radius: var(--ui-border-radius-lg); cursor: pointer; transition: var(--transition-base); border: none;
}
.btn-primary { background: var(--color-primary); color: #fff; box-shadow: var(--shadow-sm); }
.btn-primary:hover:not(:disabled) { background: var(--color-primary-dark); transform: translateY(-2px); box-shadow: var(--shadow-md); }
.btn-secondary { background: var(--bg-ternary); color: var(--text-primary); border: var(--ui-border-width) solid var(--border-primary); }
.btn-secondary:hover:not(:disabled) { background: var(--bg-hover); transform: translateY(-1px); }
.btn:disabled { opacity: var(--state-disabled-opacity, 0.5); cursor: not-allowed; transform: none; box-shadow: none; }

.btn-icon {
  width: 36px; height: 36px; border-radius: var(--ui-border-radius-sm); border: none; background: var(--bg-ternary); color: var(--text-secondary);
  display: inline-flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition-fast);
}
.btn-icon:hover { background: var(--border-primary); color: var(--text-primary); }
.btn-danger:hover { background: var(--color-error-bg); color: var(--color-error); }

/* ==========================================================================
   PROGRESS BAR
   ========================================================================== */
.form-progress { margin-bottom: var(--spacing-5xl); }
.progress-steps { display: flex; align-items: center; justify-content: space-between; max-width: 800px; margin: 0 auto; }

.step {
  display: flex; flex-direction: column; align-items: center; gap: var(--spacing-sm);
  position: relative; z-index: 2; cursor: pointer; transition: var(--transition-base);
}
.step:hover .step-number { transform: scale(1.1); box-shadow: var(--shadow-md); }

.step-number {
  width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
  background: var(--bg-ternary); border: 2px solid var(--border-secondary); color: var(--text-tertiary);
  font-weight: var(--font-weight-bold); font-family: var(--font-mono); transition: var(--transition-base);
}
.step-label { font-size: var(--font-size-sm); font-weight: var(--font-weight-bold); color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.05em; transition: var(--transition-base); }

.step.active .step-number { background: var(--color-primary); border-color: var(--color-primary); color: #fff; box-shadow: 0 0 0 4px var(--color-primary-bg); }
.step.active .step-label { color: var(--color-primary); }
.step.completed .step-number { background: var(--color-success); border-color: var(--color-success); color: #fff; }

.step-line {
  flex: 1; height: 4px; background: var(--border-primary); margin: 0 var(--spacing-md);
  margin-top: -20px; border-radius: 2px; transition: var(--transition-base);
}
.step-line.completed { background: var(--color-success); }

/* Navigation Footer */
.step-navigation {
  display: flex; justify-content: space-between; margin-top: var(--spacing-5xl);
  padding-top: var(--spacing-3xl); border-top: var(--ui-border-width) solid var(--border-primary);
}
.btn-nav { padding: var(--spacing-lg) var(--spacing-3xl); font-size: var(--font-size-lg); }

/* ==========================================================================
   FORM GRIDS & INPUTS
   ========================================================================== */
.form-step { animation: fadeIn 0.4s ease-out forwards; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.step-header { margin-bottom: var(--spacing-4xl); }
.step-header h3 { font-family: var(--font-heading); font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); margin: 0 0 var(--spacing-xs); color: var(--text-primary); }
.step-header p { font-size: var(--font-size-md); color: var(--text-secondary); margin: 0; }

.form-grid { display: grid; grid-template-columns: 1fr; gap: var(--spacing-3xl); }
@media (min-width: 768px) { .form-grid { grid-template-columns: repeat(2, 1fr); } }
.full-width { grid-column: 1 / -1; }

.form-group { display: flex; flex-direction: column; }
.input-label { font-size: var(--font-size-sm); font-weight: var(--font-weight-bold); margin-bottom: var(--spacing-md); display: flex; align-items: center; flex-wrap: wrap; }
.hint { font-size: var(--font-size-xs); color: var(--text-tertiary); font-weight: normal; margin-left: var(--spacing-sm); }
.field-hint { font-size: var(--font-size-xs); color: var(--text-secondary); margin: -var(--spacing-sm) 0 var(--spacing-md); }

/* Input Wrappers with Icons */
.input-wrapper, .textarea-wrapper, .select-wrapper { position: relative; display: flex; align-items: center; width: 100%; }
.field-icon { position: absolute; left: var(--spacing-xl); color: var(--text-tertiary); font-size: var(--font-size-lg); z-index: 1; }
.textarea-wrapper .field-icon { top: var(--spacing-xl); }

/* Core Input Styles */
.custom-input {
  width: 100%; padding: var(--spacing-xl); padding-left: calc(var(--spacing-xl) * 2.8);
  background: var(--bg-ternary); border: var(--ui-border-width-lg) solid var(--border-primary);
  border-radius: var(--ui-border-radius-lg); color: var(--text-primary); font-family: var(--font-body);
  font-size: var(--font-size-md); outline: none; transition: var(--transition-base);
}
.custom-input:focus { background: var(--bg-primary); border-color: var(--color-primary); box-shadow: 0 0 0 3px var(--color-primary-bg); }
.custom-input.error { border-color: var(--color-error); background: var(--color-error-bg); }
.custom-input.error:focus { box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-error) 20%, transparent); }

.textarea { resize: vertical; min-height: 150px; line-height: var(--line-height-relaxed); }

/* PrimeNG Select Overrides */
:host ::ng-deep .custom-select.p-select {
  width: 100%; background: var(--bg-ternary); border: var(--ui-border-width-lg) solid var(--border-primary);
  border-radius: var(--ui-border-radius-lg); box-shadow: none; padding-left: calc(var(--spacing-xl) * 1.5);
}
:host ::ng-deep .custom-select.p-select:not(.p-disabled).p-focus {
  background: var(--bg-primary); border-color: var(--color-primary); box-shadow: 0 0 0 3px var(--color-primary-bg);
}

.character-count { font-size: var(--font-size-xs); color: var(--text-tertiary); text-align: right; margin-top: var(--spacing-xs); font-family: var(--font-mono); }
.character-count.error { color: var(--color-error); }
.error-message { font-size: var(--font-size-xs); color: var(--color-error); margin-top: var(--spacing-xs); font-weight: var(--font-weight-bold); }

/* ==========================================================================
   DYNAMIC ARRAYS & TOGGLES
   ========================================================================== */
.toggle-label {
  display: flex; align-items: center; gap: var(--spacing-md); cursor: pointer; padding: var(--spacing-xl);
  border-radius: var(--ui-border-radius-lg); transition: var(--transition-base); border: var(--ui-border-width) solid var(--border-primary);
}
.toggle-label:hover { background: var(--bg-hover); }
.toggle-label input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--color-primary); cursor: pointer; }
.toggle-text { font-size: var(--font-size-md); font-weight: var(--font-weight-bold); }

.array-container { display: flex; flex-direction: column; gap: var(--spacing-md); }
.array-item { display: flex; align-items: center; gap: var(--spacing-md); }
.array-input { padding-left: var(--spacing-xl); } /* Remove icon padding for raw arrays */

.btn-add-item {
  display: inline-flex; align-items: center; gap: var(--spacing-sm); align-self: flex-start;
  padding: var(--spacing-sm) var(--spacing-xl); background: transparent; border: 2px dashed var(--border-primary);
  color: var(--text-secondary); border-radius: var(--ui-border-radius-lg); font-weight: var(--font-weight-bold);
  cursor: pointer; transition: var(--transition-base); margin-top: var(--spacing-sm);
}
.btn-add-item:hover { border-color: var(--color-primary); color: var(--color-primary); background: var(--color-primary-bg); }

/* Tags Component */
.tags-container { display: flex; flex-direction: column; gap: var(--spacing-md); }
.tags-list { display: flex; flex-wrap: wrap; gap: var(--spacing-sm); }
.tag-item {
  display: inline-flex; align-items: center; gap: var(--spacing-xs); padding: var(--spacing-xs) var(--spacing-md);
  background: var(--color-info-bg); color: var(--color-info); border: 1px solid color-mix(in srgb, var(--color-info) 30%, transparent);
  border-radius: 999px; font-size: var(--font-size-xs); font-weight: var(--font-weight-bold);
}
.tag-remove { background: transparent; border: none; color: inherit; cursor: pointer; display: flex; align-items: center; opacity: 0.7; padding: 0; }
.tag-remove:hover { opacity: 1; }
.tag-input { padding-left: var(--spacing-xl); }

/* ==========================================================================
   CONTENT UPLOAD & SECTIONS
   ========================================================================== */
.upload-area {
  border: 2px dashed var(--border-primary); border-radius: var(--ui-border-radius-xl);
  padding: var(--spacing-4xl); text-align: center; cursor: pointer; transition: var(--transition-base);
  background: var(--bg-ternary); min-height: 200px; display: flex; align-items: center; justify-content: center;
}
.upload-area:hover { border-color: var(--color-primary); background: var(--color-primary-bg); }

.upload-placeholder { display: flex; flex-direction: column; align-items: center; gap: var(--spacing-md); color: var(--text-secondary); }
.upload-placeholder i { font-size: 3rem; color: var(--color-primary); }
.upload-placeholder p { font-size: var(--font-size-md); font-weight: var(--font-weight-bold); margin: 0; }
.upload-hint { font-size: var(--font-size-xs); color: var(--text-tertiary); font-family: var(--font-mono); }

.upload-preview { position: relative; width: 100%; max-width: 400px; border-radius: var(--ui-border-radius-lg); overflow: hidden; box-shadow: var(--shadow-md); }
.upload-preview img { width: 100%; height: auto; display: block; }
.remove-btn {
  position: absolute; top: var(--spacing-sm); right: var(--spacing-sm);
  width: 32px; height: 32px; border-radius: 50%; background: rgba(0,0,0,0.6); color: #fff;
  border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(4px);
}
.remove-btn:hover { background: var(--color-error); }

/* Sections Builder */
.sections-container { display: flex; flex-direction: column; gap: var(--spacing-2xl); }

.section-item { border-left: 4px solid var(--color-primary); overflow: hidden; }
.section-header { display: flex; align-items: center; gap: var(--spacing-md); margin-bottom: var(--spacing-xl); }
.drag-handle { color: var(--text-tertiary); cursor: grab; font-size: var(--font-size-lg); }
.drag-handle:active { cursor: grabbing; }
.section-input { font-family: var(--font-heading); font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); padding-left: var(--spacing-lg); }

.section-lessons { display: flex; flex-direction: column; gap: var(--spacing-md); padding-left: var(--spacing-3xl); }

.lesson-item { display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md) var(--spacing-lg); }
.lesson-input { padding-left: var(--spacing-md); flex: 1; }
.type-icon { color: var(--text-secondary); font-size: var(--font-size-lg); width: 24px; text-align: center; }

:host ::ng-deep .lesson-type-select .p-select { width: 140px; }

.btn-add-section {
  display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-xl); background: var(--bg-ternary); border: 2px dashed var(--color-primary);
  color: var(--color-primary); border-radius: var(--ui-border-radius-lg); font-weight: var(--font-weight-bold);
  cursor: pointer; transition: var(--transition-base); margin-top: var(--spacing-xl);
}
.btn-add-section:hover { background: var(--color-primary); color: #fff; }

.btn-add-lesson {
  display: inline-flex; align-items: center; gap: var(--spacing-sm); align-self: flex-start;
  padding: var(--spacing-xs) var(--spacing-lg); background: transparent; border: none;
  color: var(--text-secondary); font-size: var(--font-size-sm); font-weight: var(--font-weight-bold);
  cursor: pointer; transition: var(--transition-base); margin-top: var(--spacing-sm);
}
.btn-add-lesson:hover { color: var(--color-primary); }

/* Responsive */
@media (max-width: 768px) {
  .lesson-item { flex-wrap: wrap; }
  .lesson-item .lesson-input { width: 100%; order: 3; }
  .lesson-item .lesson-type-select { order: 4; }
  .lesson-item .btn-danger { order: 5; margin-left: auto; }
}